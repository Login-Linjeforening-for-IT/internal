import type { FastifyInstance, FastifyPluginOptions } from "fastify"
import getIndex from './handlers/index/get.ts'
import getDockerContainers from './handlers/docker/get.ts'
import restartHandler from './handlers/docker/restart.ts'
import getServerStats from './handlers/stats/get.ts'
import restartServiceHandler from './handlers/docker/restartService.ts'
import getIngress from './handlers/nginx/getIngress.ts'
import getDockerContainer from './handlers/docker/getContainer.ts'
import getBackupStats from './handlers/backup/get.ts'
import preHandler from '#utils/auth/authMiddleware.ts'

export default async function apiRoutes(fastify: FastifyInstance, _: FastifyPluginOptions) {
    // index
    fastify.get('/', getIndex)

    // docker
    fastify.get('/docker', { preHandler }, getDockerContainers)
    fastify.get('/docker/:id', { preHandler }, getDockerContainer)
    fastify.get('/docker/restart/:id', { preHandler }, restartHandler)
    fastify.get('/docker/restart/service/:id', { preHandler }, restartServiceHandler)

    // backup
    fastify.get('/backup', { preHandler }, getBackupStats)

    // ingress
    fastify.get('/ingress/:port', { preHandler }, getIngress)

    // stats
    fastify.get('/stats', { preHandler }, getServerStats)
}
